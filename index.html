<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Real de Analizador de Gases</title>
    <link rel="icon" type="image/png" href="src/assets/logo_eco.png?v=1">
    <link rel="shortcut icon" type="image/png" href="src/assets/logo_eco.png?v=1">
    <link rel="apple-touch-icon" href="src/assets/logo_eco.png?v=1">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="assets/css/fonts.css">
    <link rel="stylesheet" href="assets/css/fontawesome-local.css">
    <script src="assets/js/chart.js"></script>
    <script src="node_modules/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="sidebar-toggle-btn" id="sidebarToggleBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="app-logo">
                    <img src="src/assets/logo.svg" alt="Logo Empresa" class="company-logo">
                </div>
                <div class="app-title">
                    <h1>Monitor Analizador de Gases</h1>
                </div>
            </div>
            <div class="header-center">
                <div class="status-indicator" id="statusIndicator">
                    <div class="status-dot"></div>
                    <span id="statusText">Desconectado</span>
                </div>
            </div>
            <div class="header-right">
                <!-- Indicador de conexi√≥n a internet -->
                <div class="internet-indicator" id="internetIndicator">
                    <div class="internet-status" id="internetStatus">
                        <span class="status-icon" id="statusIcon">üîÑ</span>
                        <span class="status-text" id="statusTextInternet">Verificando...</span>
                        <span class="status-latency" id="statusLatency"></span>
                    </div>
                </div>
                    

                <div class="window-controls">
                    <button class="window-btn minimize"><i class="fas fa-minus"></i></button>
                    <button class="window-btn maximize"><i class="fas fa-square"></i></button>
                    <button class="window-btn close"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Sidebar Overlay -->
            <div class="sidebar-overlay" id="sidebarOverlay"></div>

            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="app-logo">
                    <span>Gas Analyzer</span>
                </div>
            </div>
                
                <nav class="sidebar-menu">
                    <div class="menu-section">
                        <div class="menu-title">Principal</div>
                        <a href="#" class="menu-item active" data-tab="realtime">
                            <i class="fas fa-eye"></i>
                            <span>Datos en Tiempo Real</span>
                        </a>
                        <a href="#" class="menu-item" data-tab="monitoring-view">
                            <i class="fas fa-tv"></i>
                            <span>Vista de Monitoreo</span>
                        </a>
                        <a href="#" class="menu-item" data-tab="graphs">
                            <i class="fas fa-chart-line"></i>
                            <span>Gr√°ficos</span>
                        </a>
                    </div>
                    
                    <div class="menu-section">
                        <div class="menu-title">Control</div>
                        <a href="#" class="menu-item" data-tab="monitoring">
                            <i class="fas fa-play"></i>
                            <span>Monitoreo</span>
                        </a>
                        <a href="#" class="menu-item" data-tab="settings">
                            <i class="fas fa-cog"></i>
                            <span>Configuraci√≥n</span>
                        </a>
                    </div>
                    
                    <div class="menu-section">
                        <div class="menu-title">Datos</div>
                        <a href="#" class="menu-item" data-tab="mediciones">
                            <i class="fas fa-database"></i>
                            <span>Gesti√≥n de Mediciones</span>
                        </a>
                    </div>
                    
                    <div class="menu-section">
                        <div class="menu-title">Sistema</div>
                        <a href="#" class="menu-item" data-tab="about">
                            <i class="fas fa-info-circle"></i>
                            <span>Acerca de</span>
                        </a>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <div class="connection-status">
                        <div class="status-indicator" id="sidebarStatusIndicator">
                            <div class="status-dot"></div>
                            <span id="sidebarStatusText">Desconectado</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <div class="data-panel">
                    <!-- Content will be loaded dynamically -->

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <div class="tab-pane active" id="realtime-tab">
                            <div class="panel-header">
                                <i class="fas fa-chart-bar"></i>
                                <h2>Datos del Analizador en Tiempo Real</h2>
                            </div>
                            
                            <!-- Control de Monitoreo -->
                            <div class="monitoring-controls-main">
                                <div class="control-section-main">
                                    <h3>Control de Monitoreo</h3>
                                    <div class="button-group-main">
                                        <button id="startBtn" class="btn btn-success btn-large" disabled>
                                            <i class="fas fa-play"></i>
                                            Iniciar Monitoreo
                                        </button>
                                        <button id="stopBtn" class="btn btn-warning btn-large" disabled>
                                            <i class="fas fa-stop"></i>
                                            Detener Monitoreo
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="control-section-main">
                                    <h3>Gases a Monitorear</h3>
                                    <div class="gas-selection-main">
                                        <div class="gas-option">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="monitorO2Main" class="gas-checkbox" checked>
                                                <span class="checkmark"></span>
                                                <i class="fas fa-wind gas-icon o2-icon"></i>
                                                O‚ÇÇ - Ox√≠geno (%Vol)
                                            </label>
                                        </div>
                                        <div class="gas-option">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="monitorCOMain" class="gas-checkbox" checked>
                                                <span class="checkmark"></span>
                                                <i class="fas fa-smog gas-icon co-icon"></i>
                                                CO - Mon√≥xido de Carbono (ppm)
                                            </label>
                                        </div>
                                        <div class="gas-option">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="monitorCH4Main" class="gas-checkbox" checked>
                                                <span class="checkmark"></span>
                                                <i class="fas fa-fire gas-icon ch4-icon"></i>
                                                CH‚ÇÑ - Metano (ppm)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Lecturas Actuales -->
                            <div class="current-readings">
                                <h3>Lecturas Actuales</h3>
                                <div class="readings-grid">
                                    <div class="reading-card" id="o2ReadingCard">
                                        <div class="reading-header">
                                            <i class="fas fa-wind reading-icon o2-icon"></i>
                                            <span class="reading-label">O‚ÇÇ - Ox√≠geno</span>
                                        </div>
                                        <div class="reading-value" id="o2Value">--</div>
                                        <div class="reading-unit">%Vol</div>
                                        <div class="reading-time" id="o2Time">--:--:--</div>
                                    </div>
                                    
                                    <div class="reading-card" id="coReadingCard">
                                        <div class="reading-header">
                                            <i class="fas fa-smog reading-icon co-icon"></i>
                                            <span class="reading-label">CO - Mon√≥xido</span>
                                        </div>
                                        <div class="reading-value" id="coValue">--</div>
                                        <div class="reading-unit">ppm</div>
                                        <div class="reading-time" id="coTime">--:--:--</div>
                                    </div>
                                    
                                    <div class="reading-card" id="ch4ReadingCard">
                                        <div class="reading-header">
                                            <i class="fas fa-fire reading-icon ch4-icon"></i>
                                            <span class="reading-label">CH‚ÇÑ - Metano</span>
                                        </div>
                                        <div class="reading-value" id="ch4Value">--</div>
                                        <div class="reading-unit">ppm</div>
                                        <div class="reading-time" id="ch4Time">--:--:--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                                <div class="tab-pane" id="graphs-tab">
                                    <div class="panel-header">
                                        <i class="fas fa-chart-line"></i>
                                        <h2>Gr√°ficos de Tendencias</h2>
                                    </div>
                                    
                                    <div class="charts-container">
                                        <div class="chart-section">
                                            <div class="chart-header">
                                                <h3>O‚ÇÇ - Ox√≠geno</h3>
                                                <span class="unit">%Vol</span>
                                            </div>
                                            <div class="chart-wrapper">
                                                <canvas id="o2Chart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <div class="chart-section">
                                            <div class="chart-header">
                                                <h3>CO - Mon√≥xido de Carbono</h3>
                                                <span class="unit">ppm</span>
                                            </div>
                                            <div class="chart-wrapper">
                                                <canvas id="coChart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <div class="chart-section">
                                            <div class="chart-header">
                                                <h3>CH‚ÇÑ - Metano</h3>
                                                <span class="unit">ppm</span>
                                            </div>
                                            <div class="chart-wrapper">
                                                <canvas id="ch4Chart"></canvas>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                
                                <!-- Monitoring View Tab -->
                                <div class="tab-pane" id="monitoring-view-tab">
                                    <div class="monitoring-view-header">
                                        <div class="monitoring-status">
                                            <div class="status-indicator-large">
                                                <div class="status-dot-large" id="monitoringStatusDot"></div>
                                                <span id="monitoringStatusText">Monitoreo Activo</span>
                                            </div>
                                            <div class="monitoring-controls-top">
                                                <button id="stopMonitoringBtn" class="btn btn-danger btn-large">
                                                    <i class="fas fa-stop"></i>
                                                    Detener Monitoreo
                                                </button>
                                                <button id="exitMonitoringBtn" class="btn btn-secondary btn-large">
                                                    <i class="fas fa-arrow-left"></i>
                                                    Salir de Vista
                                                </button>
                                            </div>
                                        </div>
                                        <div class="monitoring-info">
                                            <div class="info-item">
                                                <span class="info-label">Tiempo de Monitoreo:</span>
                                                <span id="monitoringTime" class="info-value">00:00:00</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">Datos Le√≠dos:</span>
                                                <span id="monitoringDataCount" class="info-value">0</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">√öltima Lectura:</span>
                                                <span id="monitoringLastReading" class="info-value">-:-:-</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Calibration Controls for Monitoring View -->
                                    <div class="monitoring-calibration">
                                        <h3>Control de Calibraci√≥n</h3>
                                        <div class="calibration-buttons-monitoring">
                                            <button id="zeroBtnMonitoring" class="btn btn-calibration zero" title="Calibraci√≥n Zero">
                                                <i class="fas fa-circle"></i>
                                                ZERO
                                            </button>
                                            <button id="spanBtnMonitoring" class="btn btn-calibration span" title="Calibraci√≥n Span">
                                                <i class="fas fa-adjust"></i>
                                                SPAN
                                            </button>
                                            <button id="startGasBtnMonitoring" class="btn btn-calibration start-gas" title="Inicio Gas Patr√≥n">
                                                <i class="fas fa-play-circle"></i>
                                                INICIO
                                            </button>
                                            <button id="endInjectionBtnMonitoring" class="btn btn-calibration end-injection" title="Fin Inyecci√≥n Gas">
                                                <i class="fas fa-stop-circle"></i>
                                                FIN
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="monitoring-content">
                                        <!-- Gas Cards for Monitoring View -->
                                        <div class="monitoring-gas-cards" id="monitoringGasCards">
                                            <!-- Gas cards will be dynamically populated here -->
                                        </div>

                                        <!-- Real-time Charts for Monitoring -->
                                        <div class="monitoring-charts">
                                            <div class="monitoring-chart-container" id="monitoringChartContainer">
                                                <!-- Charts will be dynamically created here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Monitoring Tab -->
                                <div class="tab-pane" id="monitoring-tab">
                                    <div class="panel-header">
                                        <i class="fas fa-cog"></i>
                                        <h2>Configuraci√≥n del Sistema</h2>
                                    </div>
                                    
                                    <div class="monitoring-controls">
                                        <div class="control-section">
                                            <h3>Configuraci√≥n de Conexi√≥n</h3>
                                            <div class="form-group">
                                                <label for="portInput">Puerto:</label>
                                                <input type="text" id="portInput" class="form-control" value="COM9" placeholder="COM9" disabled>
                                            </div>
                                            <div class="form-group">
                                                <label for="slaveIdInput">Slave ID:</label>
                                                <input type="text" id="slaveIdInput" class="form-control" value="1" placeholder="1" disabled>
                                            </div>
                                            <button id="connectBtn" class="btn btn-primary" disabled>
                                                <i class="fas fa-link"></i>
                                                Conectado
                                            </button>
                                        </div>
                                        
                                        <div class="control-section">
                                            <h3>Configuraci√≥n de Lectura</h3>
                                            <div class="form-group">
                                                <label for="intervalInput">Intervalo (seg):</label>
                                                <input type="number" id="intervalInput" class="form-control" value="2.0" step="0.1" min="0.5" max="60">
                                            </div>
                                        </div>
                                
                                    </div>
                                </div>
                                
                                <!-- Settings Tab -->
                                <div class="tab-pane" id="settings-tab">
                                    <div class="panel-header">
                                        <i class="fas fa-cog"></i>
                                        <h2>Configuraci√≥n del Sistema</h2>
                                    </div>
                                    
                                    <div class="settings-content">
                                        <div class="settings-section">
                                            <h3>Configuraci√≥n de Puerto</h3>
                                            <div class="form-group">
                                                <label for="settingsPort">Puerto COM:</label>
                                                <select id="settingsPort" class="form-control">
                                                    <option value="COM9" selected>COM9</option>
                                                    <option value="COM1">COM1</option>
                                                    <option value="COM2">COM2</option>
                                                    <option value="COM3">COM3</option>
                                                    <option value="COM4">COM4</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="settingsSlaveId">Slave ID:</label>
                                                <input type="number" id="settingsSlaveId" class="form-control" value="1" min="1" max="247">
                                            </div>
                                        </div>
                                        
                                        <div class="settings-section">
                                            <h3>Configuraci√≥n de Lectura</h3>
                                            <div class="form-group">
                                                <label for="settingsInterval">Intervalo de lectura (segundos):</label>
                                                <input type="number" id="settingsInterval" class="form-control" value="2.0" step="0.1" min="0.5" max="60">
                                            </div>
                                            <div class="form-group">
                                                <label for="settingsMaxPoints">Puntos m√°ximos en gr√°ficos:</label>
                                                <input type="number" id="settingsMaxPoints" class="form-control" value="50" min="10" max="200">
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="settings-section">
                                            <h3>Configuraci√≥n de Archivo Excel</h3>
                                            <div class="form-group">
                                                <label for="settingsExcelPath">Ruta del archivo Excel:</label>
                                                <div class="path-container">
                                                    <input type="text" id="settingsExcelPath" class="form-control" readonly>
                                                    <button id="settingsSelectPathBtn" class="btn btn-secondary">
                                                        <i class="fas fa-folder-open"></i>
                                                        Seleccionar
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="settingsFileName">Nombre del archivo Excel:</label>
                                                <input type="text" id="settingsFileName" class="form-control" value="lecturas_ch4_co_o2.xlsx">
                                            </div>
                                        </div>
                                        
                                        <div class="settings-actions">
                                            <button class="btn btn-primary" id="saveSettings">
                                                <i class="fas fa-save"></i>
                                                Guardar Configuraci√≥n
                                            </button>
                                            <button class="btn btn-secondary" id="resetSettings">
                                                <i class="fas fa-undo"></i>
                                                Restaurar Valores
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mediciones Tab -->
                                <div class="tab-pane" id="mediciones-tab">
                                    <div class="panel-header">
                                        <i class="fas fa-database"></i>
                                        <h2>Gesti√≥n de Mediciones</h2>
                                    </div>
                                    
                                    <div class="mediciones-content">
                                        <!-- Filtros y controles -->
                                        <div class="mediciones-controls">
                                            <div class="filters-row">
                                                <div class="form-group">
                                                    <label for="medicionDateFrom">Desde:</label>
                                                    <input type="date" id="medicionDateFrom" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="medicionDateTo">Hasta:</label>
                                                    <input type="date" id="medicionDateTo" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="medicionEventFilter">Evento:</label>
                                                    <select id="medicionEventFilter" class="form-control">
                                                        <option value="">Todos</option>
                                                        <option value="Normal">Normal</option>
                                                        <option value="ZERO">ZERO</option>
                                                        <option value="SPAN">SPAN</option>
                                                        <option value="INICIO_GAS_PATRON">Inicio Gas Patr√≥n</option>
                                                        <option value="FIN_INYECCION_GAS">Fin Inyecci√≥n Gas</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary" id="loadMediciones">
                                                    <i class="fas fa-search"></i>
                                                    Buscar Mediciones
                                                </button>
                                            </div>
                                            
                                            <div class="actions-row">
                                                <button class="btn btn-danger" id="deleteMediciones">
                                                    <i class="fas fa-trash"></i>
                                                    Eliminar Seleccionadas
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Lista de mediciones -->
                                        <div class="mediciones-list">
                                            <div class="list-header">
                                                <h3>Lista de Mediciones</h3>
                                                <div class="list-stats">
                                                    <span id="medicionesCount">Total: 0</span>
                                                </div>
                                            </div>
                                            
                                            <div class="mediciones-table-container">
                                                <table id="medicionesTable" class="mediciones-table">
                                                    <thead>
                                                        <tr>
                                                            <th>
                                                                <input type="checkbox" id="selectAllMediciones">
                                                            </th>
                                                            <th>ID</th>
                                                            <th>Inicio</th>
                                                            <th>Fin</th>
                                                            <th>Lecturas</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="medicionesTableBody">
                                                        <tr>
                                                            <td colspan="6" class="no-data">No hay mediciones disponibles</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- Paginaci√≥n -->
                                            <div class="mediciones-pagination">
                                                <button id="prevPageBtn" class="btn btn-secondary" disabled>
                                                    <i class="fas fa-chevron-left"></i>
                                                    Anterior
                                                </button>
                                                <span id="paginationInfo">P√°gina 1 de 1</span>
                                                <button id="nextPageBtn" class="btn btn-secondary" disabled>
                                                    Siguiente
                                                    <i class="fas fa-chevron-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Detalle de Medici√≥n Modal -->
                                <div class="modal" id="medicionDetailModal">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3>Detalle de Medici√≥n</h3>
                                            <button class="modal-close" id="closeMedicionDetail">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="modal-body" id="medicionDetailContent">
                                            <!-- Contenido din√°mico -->
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary" id="exportMedicionDetail">
                                                <i class="fas fa-download"></i>
                                                Exportar Esta Medici√≥n
                                            </button>
                                            <button class="btn btn-secondary" id="closeMedicionDetailBtn">
                                                Cerrar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Modal de Env√≠o por Email -->
                                <div class="modal" id="emailModal">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3>Enviar Mediciones por Email</h3>
                                            <button class="modal-close" id="closeEmailModal">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="form-group">
                                                <label for="emailTo">Para:</label>
                                                <input type="email" id="emailTo" class="form-control" placeholder="destinatario@ejemplo.com" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="emailSubject">Asunto:</label>
                                                <input type="text" id="emailSubject" class="form-control" value="Reporte de Mediciones de Gases" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="emailBody">Mensaje:</label>
                                                <textarea id="emailBody" class="form-control" rows="4" placeholder="Mensaje adicional..."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="emailFormat">Formato:</label>
                                                <select id="emailFormat" class="form-control">
                                                    <option value="excel">Excel (.xlsx)</option>
                                                    <option value="csv">CSV (.csv)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary" id="sendEmailBtn">
                                                <i class="fas fa-paper-plane"></i>
                                                Enviar Email
                                            </button>
                                            <button class="btn btn-secondary" id="closeEmailModalBtn">
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                
                                
                                <!-- About Tab -->
                                <div class="tab-pane" id="about-tab">
                                    <div class="panel-header">
                                        <i class="fas fa-info-circle"></i>
                                        <h2>Acerca de la Aplicaci√≥n</h2>
                                    </div>
                                    
                                    <div class="about-content">
                                        <div class="about-section">
                                            <h3>Monitor Real de Analizador de Gases</h3>
                                            <p>Versi√≥n 1.0.0</p>
                                            <p>Aplicaci√≥n desarrollada para monitoreo en tiempo real de analizadores de gases mediante comunicaci√≥n Modbus RTU.</p>
                                        </div>
                                        
                                        <div class="about-section">
                                            <h3>Caracter√≠sticas</h3>
                                            <ul>
                                                <li>Comunicaci√≥n Modbus RTU</li>
                                                <li>Lectura de O‚ÇÇ, CO y CH‚ÇÑ</li>
                                                <li>Gr√°ficos en tiempo real</li>
                                                <li>Exportaci√≥n a Excel</li>
                                                <li>Interfaz industrial moderna</li>
                                            </ul>
                                        </div>
                                        
                                        <div class="about-section">
                                            <h3>Desarrollado por</h3>
                                            <p>Ecoingen</p>
                                            <p>Septiembre 2025</p>
                                        </div>
                                    </div>
                                </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Procesando...</p>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <i class="toast-icon"></i>
            <span class="toast-message"></span>
        </div>
    </div>

    <script src="renderer.js"></script>
    <script src="src/js/mediciones-manager.js"></script>
</body>
</html>
